class Y{msg;start_loc;end_loc;constructor(t,s,i){this.msg=t,this.start_loc=s,this.end_loc=i}}function Z(e){return l(m,e[0])}function q(e){if(Z(e))return e;{let t="",s=0;for(;s<e.length;){switch(e[s]){case"\u0660":t+="0";break;case"\u0661":t+="1";break;case"\u0662":t+="2";break;case"\u0663":t+="3";break;case"\u0664":t+="4";break;case"\u0665":t+="5";break;case"\u0666":t+="6";break;case"\u0667":t+="7";break;case"\u0668":t+="8";break;case"\u0669":t+="9";break;case",":t+=".";break;default:o()}s+=1}return t}}function $(e){return e==null}function y(e){return e instanceof Array}function l(e,t){return e.includes(t)}function tt(e,t,s){e[t]=s}function z(e){return Array.isArray(e)&&e.length===0}function c(e,t){let s=[];return JSON.stringify(e,(i,r)=>{if(r&&typeof r=="object"){if(s.includes(r))return"[CIRCULAR]";s.push(r)}return r})}function L(e){return new RegExp(e,"u")}function I(e,t){e==null?console.log("undefined"):console.log(JSON.stringify(e))}function o(e){throw new Error(e)}function f(e){return{...e}}function et(e,t){return e.repeat(t)}function st(e){return e.toLowerCase()}const g=["\u0660","\u0661","\u0662","\u0663","\u0664","\u0665","\u0666","\u0667","\u0668","\u0669"],m=["0","1","2","3","4","5","6","7","8","9"],it="\u0640",A=L("\\p{L}"),rt=L("\\p{N}"),J={"???":"as",\u0635\u062D\u064A\u062D:"true",\u063A\u064A\u0631_\u0635\u062D\u064A\u062D:"false",\u0639\u0646\u062F\u0645\u0627:"when",\u062D\u064A\u062B:"where",\u0627\u062D\u0636\u0631:"use",\u0639\u0631\u0641:"let",\u062B\u0627\u0628\u062A:"const",\u0645\u062A\u063A\u064A\u0631:"var",\u062F\u0644:"fn",\u0646\u0648\u0639:"type",\u0633\u0645\u0629:"trait","???":"impl",\u0631\u062F:"return",\u0646\u0641\u0630:"do"},nt={as:"???",true:"\u0635\u062D\u064A\u062D",false:"\u063A\u064A\u0631_\u0635\u062D\u064A\u062D",when:"\u0639\u0646\u062F\u0645\u0627",where:"\u062D\u064A\u062B",use:"\u0627\u062D\u0636\u0631",let:"\u0639\u0631\u0641",const:"\u062B\u0627\u0628\u062A",var:"\u0645\u062A\u063A\u064A\u0631",fn:"\u062F\u0644",type:"\u0646\u0648\u0639",trait:"\u0633\u0645\u0629",impl:"???",return:"\u0631\u062F",do:"\u0646\u0641\u0630"};class R{line;column;constructor(t,s){return this.line=t,this.column=s,this}}class at{v;loc;constructor(t,s){return this.v=t,this.loc=s,this}}class ht{lang;code;start_loc;end_loc;tokens;errs;current_index;current;lookbehind;ignore_cmts_ws;constructor(t,s,i,r,n,h,u,_,p,d){return this.lang=t,this.code=s,this.start_loc=i,this.end_loc=r,this.tokens=n,this.errs=h,this.current_index=u,this.current=_,this.lookbehind=p,this.ignore_cmts_ws=d,this}init(t,s,i){this.lang=t,this.code=s,this.start_loc=new R(1,1),this.end_loc=new R(1,1),this.tokens=[],this.errs=[],this.current_index=-1,this.current=null,this.lookbehind=null,this.ignore_cmts_ws=i}run(){this.lang==="ar"?this.ar():this.lang==="en"&&this.en(),this.start_loc=f(this.end_loc),this.add_token("$eof")}add_token(t){const s=new at(t,f(this.start_loc));this.tokens.push(s)}next(){this.lookbehind=this.current,this.current_index+=1;const t=this.code[this.current_index];return this.current=t,t===`
`?(this.end_loc.line+=1,this.end_loc.column=1):this.end_loc.column+=1,this.current}lookahead(){return this.code[this.current_index+1]}skip(t){for(;t>0;)this.next(),t-=1}insert_err(t){const s=new Y(t,f(this.start_loc),f(this.end_loc));this.errs.push(s)}last_token(){return this.tokens[this.tokens.length-1]}skip_invalid_num_or_id(){for(;this.expect_letter()||this.expect_num()||this.expect_underscore();)this.skip(1)}expect_tatweel(){return this.lookahead()===it}expect_nl_behind(){return this.lookbehind===`
`}expect_none_behind(){return $(this.lookbehind)}expect_none_ahead(){return $(this.lookahead())}expect_ws_behind(){return this.lookbehind===`
`||this.lookbehind===" "||this.lookbehind==="\r"||this.lookbehind==="	"}expect_space_ahead(){return this.lookahead()===" "||this.lookahead()==="	"}expect_ws_ahead(){return this.lookahead()===`
`||this.lookahead()===" "||this.lookahead()==="\r"||this.lookahead()==="	"}expect_nl_ahead(){return this.lookahead()===`
`}expect_separator_behind(){return this.lookbehind===","||this.lookbehind===";"||this.lookbehind===";;"||this.lookbehind===":"||this.lookbehind==="("||this.lookbehind==="["||this.lookbehind==="{"||this.lookbehind==="<"}expect_separator_ahead(){return this.lookahead()===","||this.lookahead()===";"||this.lookahead()===";;"||this.lookahead()===":"||this.lookahead()===")"||this.lookahead()==="]"||this.lookahead()==="}"||this.lookahead()===">"}expect_open_bracket(){return this.lookahead()==="["}expect_open_paren(){return this.lookahead()==="("}expect_letter(){if(this.lookahead())return this.lookahead().match(A)}expect_num(){return this.lookahead().match(rt)}expect_underscore(){return this.lookahead()==="_"}expect_eof(){return $(this.lookahead())}expect_eol(){return this.lookahead()===`
`||this.lookahead()==="\r"||this.expect_eof()}multi_comment(){if(this.lookahead()==="-"){let t="";const s=[];for(;!this.expect_eof();)if(this.current==="{"&&this.lookahead()==="-")t+=this.next()+this.next(),s.push(f(this.end_loc));else if(this.current==="-"&&this.lookahead()==="}")if(s.length>1)t+=this.next()+this.next(),s.pop();else{t+=this.next(),s.pop();break}else t+=this.next();const i=s.pop();return i&&(this.start_loc=f(i),this.insert_err("unclosed comment")),this.ignore_cmts_ws||this.add_token(["--",t]),!0}}ar_escape_char(){if(this.current==="\u066A"){let t=this.next();switch(t){case"(":switch(t=this.next(),t){case"\u0633":t=`
`;break;case"\u0631":t="\r";break;case"\u062C":t="	";break;case"\u2039":t="\u2039";break;case"\u203A":t="\u203A";break;case"\xAB":t="\xAB";break;case"\xBB":t="\xBB";break}this.next()!==")"&&this.insert_err("invalid_escape_character: "+t);break;case"\u066A":t="\u066A";break;case"{":t="${";break;default:this.insert_err("invalid escape character: "+t)}return t}else return this.current}en_escape_char(){if(this.current==="%"){let t=this.next();switch(t){case"n":t=`
`;break;case"r":t="\r";break;case"t":t="	";break;case"'":t="'";break;case'"':t='"';break;case"%":t="%";break;case"{":t="${";break;default:this.insert_err("invalid escape character: "+t);break}return t}else return this.current}enclosed_val(t){let s="";for(;!this.expect_eof()&&(this.next(),t!==this.current);){if(this.expect_eol()){this.insert_err("unclosed literal, expecting: "+t);break}this.lang==="ar"?s+=this.ar_escape_char():s+=this.en_escape_char()}return s}ar_str(){this.lookahead()==="\xAB"?this.ar_multi_str():this.add_token(["str",this.enclosed_val("\xBB")])}en_str(){this.lookahead()==='"'?this.en_multi_str():this.add_token(["str",this.enclosed_val("'")])}multi_str(t){let s="",i="";for(;!this.expect_eof();){if(this.next(),this.expect_eof()){this.insert_err("unclosed multiline String literal, expecting "+t);break}if(t===this.current&&t===this.lookahead())if(this.skip(1),this.lookahead()===t){this.skip(1),this.add_token(["str",i]);break}else s+=t+t;else this.lang==="ar"?i+=this.ar_escape_char():i+=this.en_escape_char(),i+=s}}ar_multi_str(t){this.skip(1),this.lookahead()==="\xAB"?(this.skip(1),this.multi_str("\xBB")):this.add_token(["str",""])}en_multi_str(t){this.skip(1),this.lookahead()==='"'?(this.skip(1),this.multi_str('"')):this.add_token(["str",""])}equal(){const t=[];for(;this.lookahead()==="=";)t.push(this.next());if(t.length===0)this.add_token("=");else if(t.length===1)this.add_token("==");else if(t.length>1)this.ignore_cmts_ws||this.add_token(["===",t.length+1]);else return!1;return!0}thick_arrow(){if(this.lookahead()===">")return this.next(),this.add_token("=>"),!0}add_asgmt(){if(this.lookahead()==="=")return this.next(),this.add_token("+="),!0}add(){return this.add_token("+"),!0}sub_asgmt(){if(this.lookahead()==="=")return this.next(),this.add_token("-="),!0}thin_arrow(){if(this.lookahead()===">")return this.next(),this.add_token("->"),!0}dash(){const t=[];for(;this.lookahead()==="-";)t.push(this.next());if(t.length===0)this.add_token("-");else if(t.length>1)this.ignore_cmts_ws||this.add_token(["---",t.length+1]);else return!1;return!0}tilde(){if(this.lookahead()==="~")return this.next(),this.add_token("~"),!0}mul_asgmt(){if(this.lookahead()==="=")return this.next(),this.add_token("*="),!0}mul(){return this.add_token("*"),!0}asterisk(){let t="*";for(;this.lookahead()==="*";)t+=this.next();if(t.length===1)this.mul();else return!1;return!0}ar_div_asgmt(){if(this.lookahead()==="=")return this.next(),this.add_token("\\="),!0}div_asgmt(){if(this.lookahead()==="=")return this.next(),this.add_token("/="),!0}comment(){if(this.lookahead()==="-"){let t="";for(;!this.expect_eof()&&!this.expect_eol();)t+=this.next();return this.ignore_cmts_ws||this.add_token(["--",t]),!0}}ar_div(){return this.add_token("\\"),!0}div(){return this.add_token("/"),!0}ne(){if(this.lookahead()==="=")return this.next(),this.add_token("!="),!0}exclamation(){return this.add_token("!"),!0}ge(){if(this.lookahead()==="=")return this.next(),this.add_token(">="),!0}gt(){return this.add_token(">"),!0}le(){if(this.lookahead()==="=")return this.next(),this.add_token("<="),!0}lt(){return this.add_token("<"),!0}and(){return this.lookahead()==="&"?(this.skip(1),this.add_token("&&"),!0):(this.add_token("&"),!0)}or_listpipe(){if(this.lookahead()==="|")return this.skip(1),this.lookahead()===">"?(this.skip(1),this.add_token("||>"),!0):(this.add_token("||"),!0)}pipe(){if(this.lookahead()===">")return this.skip(1),this.add_token("|>"),!0}bar(){return this.add_token("|"),!0}mashriq_float(){l(g,this.lookahead())?(v=this.current+this.mashriq_fract(),this.add_token(["float",v])):this.insert_err("ill-formed floating point number")}maghrib_float(){if(l(m,this.lookahead()))return v=this.current+this.maghrib_fract(),this.add_token(["float",v]),!0}ddot(){if(this.lookahead()===".")return this.skip(1),this.add_token(".."),!0}dot(){return this.add_token("."),!0}deconstruct(){if(this.lookahead()===">")return this.skip(1),this.add_token(":>"),!0}decl(){if(this.lookahead()==="=")return this.skip(1),this.add_token(":="),!0}dcolon(){if(this.lookahead()===":")return this.skip(1),this.lookahead()==="="?(this.skip(1),this.add_token("::=")):this.add_token("::"),!0}colon(){return this.add_token(":"),!0}ar_semicolon(){return this.add_token(";"),!0}en_semicolon(){return this.add_token(";"),!0}mashriq_num(){let t=this.current;for(;;){if(l(g,this.lookahead()))t+=this.next();else if(l(m,this.lookahead()))this.insert_err("you can either use Mashriq digits (\u0660 - \u0669) or Maghrib digits (0 - 9) but not a mix: "+this.current),this.skip_invalid_num_or_id();else if(this.lookahead()===",")t+=this.next(),t+=this.maghrib_fract();else break;if(this.expect_eof())break}this.is_float?this.add_token(["float",t]):this.add_token(["int",t])}maghrib_num(){let t=this.current,s=!1;for(;;){if(l(m,this.lookahead()))t+=this.next();else if(l(g,this.lookahead()))this.insert_err("you can either use Eastern Arabic digits (\u0660 - \u0669) or Western (0 - 9) but not a mix: "+this.current),this.skip_invalid_num_or_id();else if(this.lookahead()===".")t+=this.next(),s=!0,t+=this.maghrib_fract();else break;if(this.expect_eof())break}s?this.add_token(["float",t]):this.add_token(["int",t])}ar_id(){let t=this.current;for(;!this.expect_eof()&&(this.expect_letter()||this.expect_num()||this.expect_underscore());)this.expect_tatweel()?l(["\u0641","\u0644","\u0627\u0647","\u0643"],t)?t+=this.next():this.skip(1):t+=this.next();J[t]?this.add_token(["key",J[t]]):this.add_token(["id",t])}en_id(){let t=this.current;for(;!this.expect_eof()&&(this.expect_letter()||this.expect_num()||this.expect_underscore());)t+=this.next();nt[t]?this.add_token(["key",t]):this.add_token(["id",t])}mashriq_fract(){let t="";for(;!this.expect_eof()&&l(g,this.lookahead());)t+=this.next();return t}maghrib_float(){if(l(m,this.lookahead())){const t=this.current+this.maghrib_fract();return this.add_token(["float",t]),!0}}maghrib_fract(){let t="";for(;!this.expect_eof()&&l(m,this.lookahead());)t+=this.next();return t}new_line(){let t=1;for(;;)if(this.lookahead()===`
`)this.skip(1),t+=1;else{this.last_token()&&this.last_token().v!==`
`&&this.add_token([`
`,t]);break}}ar(){for(;!this.expect_eof();){this.start_loc=f(this.end_loc);const t=this.next();switch(t){case"\u061F":this.add_token("?");break;case"\u066A":this.add_token("%");break;case",":this.mashriq_float();break;case".":this.maghrib_float()||this.ddot()||this.dot();break;case"\u060C":this.add_token(",");break;case"\xD7":this.mul_asgmt()||this.mul();break;case"*":this.mul_asgmt()||this.asterisk();break;case"\xF7":case"/":this.div_asgmt()||this.div();break;case"\\":this.ar_div_asgmt()||this.ar_div();break;case"\u061B":this.ar_semicolon();break;case"\xAB":this.ar_str();break;default:l(g,t)?this.mashriq_num():l(m,t)?this.maghrib_num():t==="_"||t.match(A)?this.ar_id():this.common(t)}}}en(){for(;!this.expect_eof();){this.start_loc=f(this.end_loc);const t=this.next();switch(t){case"?":this.add_token("?");break;case"%":this.add_token("%");break;case".":this.maghrib_float()||this.ddot()||this.dot();break;case",":this.add_token(",");break;case"*":this.mul_asgmt()||this.asterisk();break;case"/":this.div_asgmt()||this.div();break;case";":this.en_semicolon();break;case"'":this.en_str();break;default:l(m,t)?this.maghrib_num():l(g,t)?(this.insert_err("only English Numerals are allowed in English source files: "+this.current),this.skip_invalid_num_or_id()):t==="_"||t.match(A)?this.en_id():this.common(t)}}}common(t){switch(t){case`
`:this.new_line();break;case"\r":case"	":case" ":this.ignore_cmts_ws||this.add_token(t);break;case"&":this.and();break;case"|":this.pipe()||this.or_listpipe()||this.bar();break;case"+":this.add_asgmt()||this.add();break;case"-":this.comment()||this.sub_asgmt()||this.thin_arrow()||this.dash();break;case"~":this.tilde();break;case"^":this.add_token("^");break;case"=":this.thick_arrow()||this.equal();break;case"!":this.ne()||this.exclamation();break;case">":this.ge()||this.gt();break;case"<":this.le()||this.lt();break;case":":this.deconstruct()||this.decl()||this.dcolon()||this.colon();break;case"`":this.transl();break;case"$":this.add_token("$");break;case"[":this.add_token("[");break;case"]":this.add_token("]");break;case"(":this.add_token("(");break;case")":this.add_token(")");break;case"{":this.multi_comment()||this.add_token("{");break;case"}":this.add_token("}");break;default:this.insert_err("unrecognized character: "+this.current)}}}const ot=[],U=[];class a{id;t;v;constructor(t,s,i){this.id=t,this.t=s,this.v=i}}class W{t;o;constructor(t,s){this.t=t,this.o=s}}class _t{name;fields;children;constructor(t,s,i){this.name=t,this.fields=s,this.children=i}}class ct{fields;o;constructor(t,s){this.fields=t,this.o=s}}class ut{t;ts;o;constructor(t,s,i){this.t=t,this.ts=s,this.o=i}}class pt{name;variant;constructor(t,s){this.name=t,this.variant=s}}class M{k;v;constructor(t,s){this.k=t,this.v=s}}class b{opr;op;constructor(t,s){this.opr=t,this.op=s}}class C{lopr;op;ropr;constructor(t,s,i){this.lopr=t,this.op=s,this.ropr=i}}class N{name;params;ret_types;body;constructor(t,s,i,r){this.name=t,this.params=s,this.ret_types=i,this.body=r}}class P{_pat;t;constructor(t,s){this._pat=t,this.t=s}}class lt{k;v;constructor(t,s){this.k=t,this.v=s}}class D{lhs;t;rhs;constructor(t,s,i){this.lhs=t,this.t=s,this.rhs=i}}class dt{expr;arms;constructor(t,s){this.expr=t,this.arms=s}}class ft{pats;expr;constructor(t,s){this.pats=t,this.expr=s}}const bt=["+","-","*","/","[","~=","::",":=","=","+=","-=","*=","/=","|=","&=","==","!=",">",">=","<","<=","|","||","|>","||>",":>","&","&&",".",".."],mt=[".","!","not","-","+"],kt=["?","!","%"],vt=["=",":","::",":=","~=","+=","-=","*=","/=","\xF7=","&=","&&=","|=","||="];class xt{tokens;current_index;skipped_new_line;current;ast;tabs;attrs;errs;init(t){this.tokens=t,this.current_index=-1,this.skipped_new_line=!1,this.current=null,this.ast=[],this.attrs=[],this.errs=[]}run(){for(this.next();!this.is_eof();){let t=!1;this.maybe_attrs()?(this.maybe_modifier(),t=this.maybe_typedef()||this.maybe_consts_or_fns()):this.is_modifier()?(this.maybe_modifier(),t=this.maybe_consts_or_fns()||this.maybe_typedef()):t=this.maybe_use()||this.maybe_consts_or_fns()||this.maybe_typedef(),t||o("invalid syntax: "+c(this.current))}}next(t){this.current_index+=1;const s=this.tokens[this.current_index];return this.current=s,s.v[0]===`
`?(this.skipped_new_line=!0,this.next(!0)):t||(this.skipped_new_line=!1),this.current}backtrack(){this.current_index-=1;const t=this.tokens[this.current_index];this.current=t,t.v[0]===`
`&&this.backtrack()}skip(){return this.next()}lookahead(){return this.lookahead_n(1)}lookahead_n(t){let s=this.current_index;for(;t>0;){for(s+=1;;){const i=this.tokens[s];let r;if(i&&(r=i.v[0]===`
`),r)s+=1;else break}t-=1}return this.tokens[s]}lookahead_ws(){const t=this.current_index+1;return this.tokens[t]}is_eof(){return this.current.v==="$eof"}is_newline(){return this.skipped_new_line}is_asterisk(){return this.current.v==="*"}is_asgmt(){return this.current.v==="="}is_hash(){return this.current.v==="--"}is_percent(){return this.current.v==="%"}is_dpercent(){return this.current.v==="%%"}is_behind_none(){return $(this.lookbehind)}is_behind_nl(){return this.lookbehind===`
`}is_dot(){return this.current.v==="."}is_colon(){return this.current.v===":"}is_dcolon(){return this.current.v==="::"}is_caret(){return this.current.v==="^"}is_semicolon(){return this.current.v===";"}is_comma(){return this.current.v===","}is_backtick(){return this.current.v==="`"}is_tbacktick(){return this.current.v[0]==="```"}is_underscore(){return this.is_id()&&this.current.v[1]==="_"}is_plus(){return this.current.v==="+"}is_minus(){return this.current.v==="-"}is_exclamation(){return this.current.v==="!"}is_question(){return this.current.v==="?"}is_bar(){return this.current.v==="|"}is_thin_arrow(){return this.current.v==="->"}is_thick_arrow(){return this.current.v==="=>"}is_tilde(){return this.current.v==="~"}is_or(){return this.is_keyword("or")}is_and(){return this.is_keyword("and")}is_not(){return this.is_keyword("not")}is_use(){return this.is_keyword("use")}is_let(){return this.is_keyword("let")}is_if_let(){return this.is_keyword("if_let")}is_const(){return this.is_keyword("const")}is_var(){return this.is_keyword("var")}is_then(){return this.is_keyword("then")}is_do(){return this.is_keyword("do")}is_end(){return this.is_keyword("end")}is_fn(){return this.is_keyword("fn")}is_alias(){return this.is_keyword("alias")}is_typedef(){return this.is_keyword("type")}is_open_paren(){return this.current.v==="("}is_close_paren(){return this.current.v===")"}is_open_curly(){return this.current.v==="{"}is_close_curly(){return this.current.v==="}"}is_open_bracket(){return this.current.v==="["}is_close_bracket(){return this.current.v==="]"}is_open_angle(){return this.current.v==="<"}is_close_angle(){return this.current.v===">"}is_double_close_angle(){return this.current.v===">>"}is_if(){return this.is_keyword("if")}is_else(){return this.is_keyword("else")}is_ret(){return this.is_keyword("return")}is_break(){return this.is_keyword("break")}is_when(){return this.is_keyword("when")}is_for(){return this.is_keyword("for")}is_in(){return this.is_keyword("in")}is_while(){return this.is_keyword("while")}is_bool(){return this.is_keyword("true")||this.is_keyword("false")}is_char(){return this.current.v[0]==="char"}is_str(){return this.current.v[0]==="str"}is_int(){return this.current.v[0]==="int"}is_float(){return this.current.v[0]==="float"}is_modifier(){const t=this.expect_plus()||this.expect_minus()&&this.lookahead_n(2).v===")";return this.is_open_paren()&&t}is_this(){return this.is_keyword("this")}is_keyword(t){return this.current.v[0]==="key"&&this.current.v[1]===t}is_id(){return this.current.v[0]==="id"}is_id_pat(){return this.current.v[0]==="id"}is_bool_pat(){return this.current.v[0]==="bool"}is_char_pat(){return this.current.v[0]==="char"}is_str_pat(){return this.current.v[0]==="str"}is_int_pat(){return this.current.v[0]==="int"}is_float_pat(){return this.current.v[0]==="float"}is_tuple_pat(){return this.is_open_paren()}is_list_pat(){return this.is_open_bracket()}is_structl_pat(){return this.is_open_curly()}is_enum_pat(){return this.is_dot()}is_pat(){return this.is_bool_pat()||this.is_char_pat()||this.is_str_pat()||this.is_int_pat()||this.is_float_pat()||this.is_list_pat()||this.is_tuple_pat()||this.is_structl_pat()||this.is_enum_pat()||this.is_id_pat()||this.is_underscore()}is_assoc_fn(){if(y(this.current.v))return this.is_fn()&&this.lookahead().v==="^"}is_method(){if(y(this.current.v))return this.is_fn()&&this.lookahead().v!=="^"}expect_short_asgmt(){return this.lookahead().v===":="}expect_colon(){return this.lookahead().v===":"}expect_comma(){return this.lookahead().v===","}expect_plus(){return this.lookahead().v==="+"}expect_minus(){return this.lookahead().v==="-"}expect_id(){return this.lookahead().v[0]==="id"}expect_str(){return this.lookahead().v[0]==="str"}expect_eof(){return this.lookahead().v==="$eof"}expect_close_paren(){return this.lookahead().v===")"}expect_close_bracket(){return this.lookahead().v==="]"}expect_open_curly(){return this.lookahead().v==="{"}expect_close_curly(){return this.lookahead().v==="}"}expect_astrisk(){return this.lookahead().v==="*"}expect_asgmt(){return this.lookahead().v==="="}maybe_asgmt(){if(this.is_asgmt())return this.next(),!0}maybe_comma(){if(this.is_comma())return this.next(),!0}optional_comma(){return this.is_newline()||this.is_close_curly()||this.is_close_paren()||this.is_close_bracket()||this.is_close_angle()||this.is_thin_arrow()||this.is_thick_arrow()?this.maybe_comma():this.req_comma()}maybe_colon(){if(this.is_colon())return this.next(),!0}maybe_open_curly(){if(this.is_open_curly())return this.next(),!0}maybe_id(){if(this.is_id()){const t=this.current;return this.next(),t}}maybe_asterisk(){if(this.is_asterisk())return this.current,this.next(),this.asterisk}maybe_open_paren(){if(is_open_paren())return this.next(),!0}maybe_modifier(){if(!this.is_modifier())return;this.next();const t=new a("modif","",this.current);return this.next(),this.req_close_paren(),this.ast.push(t),!0}maybe_attrs(){for(;this.is_hash();){this.skip();const t=this.maybe_id();if(this.id||o("expecting an id: "+c(this.current)),this.attrs.push(t),this.lookahead().v!==",")return null;this.skip()}if(this.attrs.length>0)return!0}maybe_pat(){if(this.is_pat())return this.prim_pat()}req_in(){if(this.is_in())return this.next(),!0;o('expecting "in" : '+c(this.current))}req_asgmt(){return this.maybe_asgmt()||o("expecting '=' : "+c(this.current)),!0}req_comma(){if(this.is_comma())return this.next(),!0;o("expecting ',' after : "+c(this.current))}req_backtick(){if(this.is_backtick())return this.next(),!0;o("expecting '`' after : "+c(this.current))}req_tbacktick(){if(this.is_tbacktick())return this.next(),!0;o("expecting '```' after : "+c(this.current))}req_terminator(){return this.is_newline()||this.is_eof()}req_open_paren(){if(this.is_open_paren())return this.next(),!0;o("expecting '(' : "+c(this.current))}req_close_paren(){if(this.is_close_paren())return this.next(),!0;o("expecting ')' : "+c(this.current))}req_open_curly(){if(this.is_open_curly())return this.next(),!0;o("expecting '{' : "+c(this.current))}req_close_curly(){if(this.is_close_curly())return this.next(),!0;o("expecting '}' : "+c(this.current))}req_close_angle(){if(this.is_close_angle())return this.next(),!0;o("expecting '>' : "+c(this.current))}req_colon(){if(this.is_colon())return this.next(),!0;o("expecting a colon ':' "+c(this.current))}req_dcolon(){if(this.is_dcolon())return this.next(),!0;o("expecting a double colon '::' "+c(this.current))}req_open_bracket(){if(this.is_open_bracket())return this.next(),!0;o("expecting '[' : "+c(this.current))}req_close_bracket(){if(this.is_close_bracket())return this.next(),!0;o("expecting ']' : "+c(this.current))}req_thin_arrow(){if(this.is_thin_arrow())return this.next(),!0;o("expecting '->' : "+c(this.current))}req_thick_arrow(){if(this.is_thick_arrow())return this.next(),!0;o("expecting '=>' : "+c(this.current))}req_then(){if(this.is_then())return this.next(),!0;o("expecting 'then' : "+c(this.current))}req_pat(){const t=this.maybe_pat();if(t)return t;o("expecting a pattern: "+c(this.current))}prim_pat(){if(this.is_underscore()){const t=new a("_","pat","");return this.next(),t}else{if(this.is_bool_pat())return this.bool_pat();if(this.is_char_pat())return this.char_pat();if(this.is_str_pat())return this.str_pat();if(this.is_int_pat())return this.int_pat();if(this.is_float_pat())return this.float_pat();if(this.is_list_pat())return this.list_pat();if(this.is_tuple_pat())return this.tuple_pat();if(this.is_structl_pat())return this.structl_pat();if(this.is_enum_pat())return this.enum_pat();if(this.is_id_pat())return this.id_pat()}}bool_pat(){const t=new a("bool","pat",this.current);return this.next(),t}char_pat(){const t=new a("char","pat",this.current);return this.next(),t}str_pat(){const t=new a("str","pat",this.current);return this.next(),t}int_pat(){const t=new a("int","pat",this.current);return this.next(),t}float_pat(){const t=new a("float","pat",this.current);return this.next(),t}list_pat(){if(!this.is_open_bracket())return;this.next();const t=[];for(this.maybe_comma();;){if(t.length>0&&!this.req_comma())return;const s=this.maybe_pat();if(s)return t.push(s);break}return this.maybe_comma(),this.req_close_bracket(),new a("[","pat",t)}tuple_pat(){if(!this.is_open_paren())return;this.next();const t=[];for(this.maybe_comma();;){t.length>0&&this.req_comma();const s=this.maybe_pat();if(s)return t.push(s);break}return this.maybe_comma(),this.req_close_paren(),new a("(","pat",t)}structl_pat(){if(!this.is_open_curly())return;this.next();const t=[];for(this.maybe_comma();;){t.length>0&&(this.maybe_comma()||this.req_terminator());const s=this.maybe_id();if(!s)break;let i;this.is_colon()&&(this.next(),i=this.req_pat());const r=new lt(s,i);t.push(r)}return this.maybe_comma(),this.req_close_curly(),new a("{","pat",t)}enum_pat(){o("enum patterns are not supported yet");const t=this.current;this.next();const s=new pt(t,_pat);if(_pat)return new a("enum_pat","pat",s)}id_pat(){const t=this.current;return this.next(),new a("id","pat",t)}req_body(){const t=this.stmts();return new a("body","body",t)}req_body_ret(){const t=this.req_body();return this.implicit_return(t.v),t}maybe_stmt(){if(!(this.is_eof()||this.is_modifier()))return this.maybe_break()||this.maybe_const()||this.maybe_let()||this.maybe_expr()||this.maybe_semicolon()}req_stmts(){const t=this.current,s=this.stmts();if(z(s))o("expecting a statement : "+c(t));else return s}stmts(){let t=[],s;for(;s=this.maybe_stmt(),s&&t.push(s),!!s;);return t}maybe_ret(){if(!this.is_ret())return;this.next();const t=this.maybe_expr();return new a("return","expr",t)}maybe_break(){return this.is_break()?(this.next(),new a("break","stmt",null)):void 0}maybe_const(){if(!this.is_const())return;this.next();const t=this.req_pat(),s=this.maybe_tannotation();this.req_asgmt();const i=this.req_expr(),r=new D(t,s,i);return new a("const","stmt",r)}maybe_let(){if(!this.is_let())return;this.next();const t=this.req_pat(),s=this.maybe_tannotation();this.req_asgmt();const i=this.req_expr(),r=new D(t,s,i);return new a("var","stmt",r)}req_expr(){const t=this.current,s=this.maybe_expr();if(s)return s;o("expecting expression : "+c(t))}maybe_do_block_ret(){const t=this.maybe_do_block();if(t)return this.implicit_return(t.v),t}req_do_block_ret(){const t=this.req_do_block();return this.implicit_return(t.v),t}maybe_do_block(){if(!this.is_do())return;this.next();const t=[];for(this.req_open_curly();!(this.is_eof()||this.is_close_curly());){const s=this.maybe_stmt();if(s)t.push(s);else break}return this.req_close_curly(),new a("do_block","expr",t)}req_do_block(){const t=this.current,s=this.maybe_do_block();if(s)return s;o("expecting 'do' block : "+c(t))}maybe_block(){if(!this.is_open_curly())return;this.next();const t=[];for(;!(this.is_eof()||this.is_end());){const s=this.maybe_stmt();if(s)t.push(s);else break}return this.implicit_return(t),this.req_end(),new a("block","expr",t)}maybe_semicolon(){if(!this.is_semicolon())return;const t=this.next();return new a(";","expr",t)}is_bin_op(){if(this.current.v==="("||this.current.v==="{"||this.current.v==="["){if(!this.is_newline())return!0}else return l(bt,this.current.v)}is_postfix_uni_op(){return l(kt,this.current.v)}req_list_index(){const t=this.req_expr();if(t){if(this.req_close_bracket())return t}else o("expecting  an index [...]: "+c(this.current))}req_access(t){return this.req_expr()}req_call_args(){const t=[];for(;!(this.is_eof()||this.is_close_paren());){t.length>0&&(this.is_newline()?this.maybe_comma():this.req_comma());let s=this.maybe_expr();s&&t.push(s)}return this.req_close_paren(),new a("args","expr",t)}maybe_lopr_prefix_postfix(t,s){const i=t.v.opr,r=t.v.op;if(t.id==="prefix")if(this.prec_uni(s)>=this.prec_uni(r)){const n=new b(i,s),h=new a("postfix","expr",n),u=new b(h,r),_=new a("prefix","expr",u);return this.next(),_}else{const n=new b(t,s),h=new a("postfix","expr",n);return this.next(),h}}maybe_lopr_bin_postfix(t,s){if(t.id==="bin"){const i=t.v.op,r=t.v.ropr,n=t.v.lopr;if(this.prec_uni(s)>=this.prec_bin(i)){const h=new b(r,s),u=new a("postfix","expr",h),_=new C(n,i,u),p=new a("bin","expr",_);return this.next(),p}else{const h=new b(t,s),u=new a("postfix","expr",h);return this.next(),u}}}maybe_lopr_prefix_bin(t,s){const i=t.v.op;let r=t.v.opr;if(t.id==="prefix")if(this.prec_uni(i)>=this.prec_bin(s)){r=this.req_op(r);const n=new b(r,i);return new a("prefix","expr",n)}else{const n=this.req_ropr(t),h=new C(r,s,n),u=new a("bin","expr",h),_=new b(u,i);return new a("prefix","expr",_)}}get_lopr(t,s){let i=this.maybe_lopr_prefix_postfix(t,s);if(!i&&(i=this.maybe_lopr_bin_postfix(t,s),!i)){const r=new b(t,s);i=new a("postfix","expr",r),this.next()}return i}req_ropr(t){let s;const i=this.current;return this.is_open_bracket()?(this.next(),s=this.req_list_index()):this.is_dot()?(this.next(),s=this.req_access(t)):this.is_open_paren()?(this.next(),s=this.req_call_args()):(this.next(),s=this.maybe_expr()),s||o("expecting right operand: "+c(i)),s}prec_uni(t){switch(t.v){case"%":return 60;case".":return 50;case"!":case"?":return 16;case"+":case"-":case"_!":case"not":return 15;case"\u23CE":return 0;default:o("unexpected unary operator: "+c(t))}}prec_bin(t){switch(t.v){case"[":return 20;case"(":case"{":return 19;case".":return 18;case"*":case"\xD7":case"/":case"\xF7":return 13;case"+":case"-":return 12;case"<":case"<=":case">":case">=":return 11;case"==":case"!=":return 10;case"<<":case">>":return 8;case"&":return 7;case"**":case"\u2295":return 6;case"|":return 5;case"&&":return 4;case"||":return 3;case"|>":case"||>":case":>":return 2;case"=":case":=":case"::":case"~=":case"+=":case"-=":case"*=":case"\xD7=":case"/=":case"\xF7=":case"&=":case"|=":case"^=":case">>=":case"<<=":return 1;default:o("unexpected binary operator: "+c(t))}}is_bin_rassoc(t){return l(vt,t)}maybe_op(t){const s=this.current;if(this.is_postfix_uni_op())return this.get_lopr(t,s);if(this.is_bin_op()){const i=this.maybe_lopr_prefix_bin(t,s);if(i)return i;let r=this.req_ropr(t);r&&(r.id==="bin"?r=this.while_op(r,this.prec_bin(r.v.op)>this.prec_bin(s)||this.prec_bin(r.v.op)===this.prec_bin(s)&&this.is_bin_rassoc(r.v.op)):r.id==="prefix"?r=this.while_op(r,this.prec_bin(s)>this.prec_uni(r.v.op)||this.is_bin_rassoc(s)):r=this.while_op(r,!1));const n=new C(t,s,r);return new a("bin","expr",n)}}req_op(t){const s=this.maybe_op(t);if(s)return s;o("expect an operation: "+c(this.lookahead()))}while_op(t,s){let i=f(t);if(this.is_eof())return i;for(;(this.is_bin_op()||this.is_postfix_uni_op())&&s!==!1;)i=this.req_op(i);return i}maybe_expr(){let t=this.maybe_prim();if(t)return t=this.while_op(t),t}req_id(){const t=this.maybe_id();if(t)return t;o("expecting an ID: "+c(this.current))}maybe_unit(){if(this.is_open_paren()&&this.expect_close_paren())return this.next(),this.next(),new a("()","expr","()")}maybe_afn(t){const s=()=>{if(!t)return;y(t)||(t=[t]);const i=[];return t.forEach(r=>{r.id="id",r.type="pat",i.push(new a("param","pat",new P(r)))}),i};if(this.is_thick_arrow()){const i=s();this.next(),this.req_open_curly();const r=this.req_body_ret();this.req_close_curly();const n=new N("",i,null,r);return new a("afn","expr",n)}}maybe_tuple_afn_group(){if(this.is_open_paren()){const t=this.current.loc;if(this.next(),this.is_id()&&this.expect_colon())return this.req_named_tuple();{let s=null;if(s=this.maybe_expr(),s){let i=s;if(this.is_comma()){const r=[i];for(;;){const h=this.is_comma()&&this.expect_close_paren();if(this.is_eof()||this.is_close_paren()||h)break;this.req_comma(),i=this.maybe_expr(),i?r.push(i):o("expected an argument: "+t)}return this.maybe_comma(),this.req_close_paren(),this.maybe_afn(r)||new a("tuple","expr",r)}else return this.req_close_paren(),this.maybe_afn(s)||(s.grouped=!0,s)}}}}req_named_tuple(){let t=[];for(;!(this.is_eof()||this.is_close_paren());){let s=this.req_id();this.req_colon();let i=this.req_expr();t.push([s,i]),this.optional_comma()}return this.req_close_paren(),new a("named_tuple","expr",t)}is_prefix_uni_op(){return l(mt,this.current.v)}maybe_prefix_uni_op(){if(this.is_prefix_uni_op()){const t=this.current;this.next();const s=new b(this.req_prim(),t);return new a("prefix","expr",s)}}maybe_literal(){let t=this.maybe_primitivel();return t||(t=this.maybe_list()),t||(t=this.maybe_tuple()),t}maybe_primitivel(){let t=this.maybe_bool();return t||(t=this.maybe_char()),t||(t=this.maybe_str()),t||(t=this.maybe_int()),t||(t=this.maybe_float()),t}maybe_bool(){if(this.is_bool()){const t=new a("bool","expr",this.current);return this.next(),t}}maybe_char(){if(this.is_char()){const t=new a("char","expr",this.current);return this.next(),t}}maybe_str(){if(this.is_str()){const t=new a("str","expr",this.current);return this.next(),t}}maybe_int(){if(this.is_int()){const t=this.current;this.next();let s;return this.is_id()&&!this.is_newline()&&(s=this.current,this.next()),new a("int","expr",[t,s])}}maybe_float(){if(this.is_float()){const t=this.current;this.next();let s;return this.is_id()&&!this.is_newline()&&(s=this.current,this.next()),new a("float","expr",[t,s])}}maybe_list(){if(this.is_open_bracket()){const t=[];for(this.next(),this.maybe_comma();;){const s=this.is_comma()&&this.expect_close_bracket();if(this.is_eof()||this.is_close_bracket()||s)break;t.length>0&&(this.is_newline()?this.maybe_comma():this.req_comma()),t.push(this.req_expr())}return this.maybe_comma(),this.req_close_bracket(),new a("[","expr",t)}}maybe_tuple(){if(this.is_open_paren()){const t=[];this.skip(),this.maybe_comma();let s=!1;for(this.is_id&&this.expect_colon()&&(s=!0);;){t.length>0&&this.req_comma();let i;s&&(i=this.req_id(),this.req_colon());let r=this.req_expr();if(s?t.push([i,r]):t.push([r]),this.is_close_paren())break}return this.maybe_comma(),this.req_close_paren(),s?new a("(:","expr",t):new a("(","expr",t)}}maybe_call(t){const s=()=>{const h=[];if(this.is_open_paren()){for(this.next();!(this.is_eof()||this.is_close_paren());){let u;this.is_id()&&this.expect_colon()&&(u=this.current,this.next(),this.next());let _;if(u?_=new a("named_arg","expr",[u,this.req_expr()]):_=this.maybe_expr(),!_)break;h.push(_),this.optional_comma()}return this.req_close_paren(),h}},i=h=>{if(!this.is_open_curly())return;this.next();const u=[];for(;!(this.is_eof()||this.is_close_curly());){const _=this.maybe_expr();if(!_)break;u.push(_),this.optional_comma()}return this.req_close_curly(),u.push(),u},r=s(),n=i();return r||n?new a("call","expr",[t,r,n]):void 0}req_ref(){const t=this.current;return this.next(),new a("ref","expr",t)}maybe_call_or_ref(){if(this.is_id()){const t=this.req_ref();return this.maybe_call(t)||t}}maybe_when_arm(){const t=[];for(;!this.is_thin_arrow()&&(t.push(this.req_pat()),this.is_bar());)this.next();this.req_thin_arrow();const s=this.req_expr(),i=new ft(t,s);return new a("arm","",i)}maybe_when(){if(!this.is_when())return;this.next(),this.req_open_paren();const t=this.maybe_expr();this.req_close_paren(),this.req_open_curly();const s=[];for(this.maybe_comma();!(this.is_eof()||this.is_close_curly()||s.length>0&&(this.optional_comma(),this.is_eof()||this.is_close_curly()));){const r=this.maybe_when_arm();if(r)s.push(r);else break}this.maybe_comma(),this.req_close_curly();const i=new dt(t,s);return new a("when","expr",i)}maybe_prim(){let t=this.maybe_unit();return t||(t=this.maybe_tuple_afn_group()),t||(t=this.maybe_prefix_uni_op()),t||(t=this.maybe_call_or_ref()),t||(t=this.maybe_literal()),t||(t=this.maybe_when()),t||(t=this.maybe_do_block_ret()),t||(t=this.maybe_ret()),t||(t=this.maybe_semicolon()),t}req_prim(){const t=this.maybe_prim();return t||o("expecting an expression: "+c(this.current)),t}maybe_fn(){if(this.current,!this.is_fn())return;this.next();const t=this.req_fn();return t&&l(["main","\u0628\u062F\u0621"],t.v.name.v[1])?new a("main","fn",t.v):new a("fn","fn",t.v)}maybe_use(){if(!this.is_use())return;this.next();const t=[];if(!this.is_id())return!1;for(;this.is_id()&&(t.push(this.current),this.next(),this.is_dot());)this.skip(),this.is_id()||o("expecting an idnetifier after "+c(this.current));const s=new a("use","stmt",t);return this.ast.push(s),!0}maybe_optional(){if(this.is_question())return this.next(),!0}maybe_type(){let t;if(this.is_open_bracket()){this.next();const s=this.req_type();this.req_close_bracket();const i=new W(s,this.maybe_optional());t=new a("[","t",i)}else if(this.is_open_curly()){this.next();const s=[];for(this.maybe_comma();!(this.is_eof()||this.is_close_curly());){s.length>0&&this.req_comma();const r=this.maybe_id();let n;r&&this.is_colon()&&(this.next(),n=this.req_type());const h=new M(r,n);s.push(h)}this.maybe_comma(),this.req_close_curly();const i=new ct(s,this.maybe_optional());t=new a("{","t",i)}else if(this.is_id()){const s=this.req_id();if(this.is_open_angle()){const i=[];for(this.next(),this.maybe_comma();!(this.is_eof()||this.is_close_angle());)i.length>0&&this.req_comma(),i.push(this.req_type());this.maybe_comma(),this.req_close_angle();const r=new ut(s,i,this.maybe_optional());t=new a("<","t",r)}else{const i=new W(s,this.maybe_optional());t=new a("t","t",i)}}return t}req_type(){let t=this.maybe_type();return t||o("type required: "+c(this.current)),t}maybe_tannotation(){if(this.is_colon())return this.next(),this.maybe_type()}req_tannotation(){const t=this.maybe_tannotation();return t||o("requires type annotation: "+c(this.current)),t}maybe_fn_params(){const t=[];if(!this.is_open_paren())return t;for(this.next(),this.maybe_comma();!(this.is_close_paren()||this.is_eof());){t.length>0&&this.req_comma();const s=this.req_pat(),i=this.maybe_tannotation(),r=new P(s,i),n=new a("param","pat",r);s.id!=="id"&&o("only parameters with id patterns are currently supported"),t.push(n)}return this.maybe_comma(),this.req_close_paren(),t}maybe_fn_ret_types(){const t=[];if(this.is_thin_arrow())for(this.next();this.is_id();){let s=this.next();this.is_exclamation()?(this.next(),t.push({id:s,_t:"throw"})):t.push({id:s,_t:"ret_type"}),this.optional_comma()}return t}req_fn(){const t=this.req_id();ot.push(t.v[1]);const s=this.maybe_fn_params(),i=this.maybe_fn_ret_types();if(this.is_open_curly()){this.next();const r=this.req_body_ret(),n=new N(t,s,i,r),h=new a("fn","fn",n);return this.req_close_curly(),h}else{this.req_asgmt();const r=this.req_body_ret(),n=new N(t,s,i,r);return new a("fn","fn",n)}}maybe_fields(){const t=[];for(;this.is_id();){const s=new a("id","expr",this.req_id()),i=this.req_tannotation(),r=new M(s,i),n=new a("field","",r);if(t.push(n),this.is_close_paren())break;this.optional_comma()}return t}maybe_typedef(){const t=()=>{const _=[];if(this.is_open_paren()){for(this.next();!(this.is_eof()||this.is_close_paren());){let p;this.is_id()&&this.expect_colon()&&(p=this.current,this.next(),this.next());let d;if(p?d=new a("field","expr",[p,this.req_type()]):d=this.maybe_expr(),!d)break;_.push(d),this.optional_comma()}return this.req_close_paren(),_}},s=()=>{if(!this.is_open_curly())return;this.next();const _=[];for(;!(this.is_eof()||this.is_close_curly());){const p=this.maybe_expr();if(!p)break;_.push(p),this.optional_comma()}return this.req_close_curly(),_.push(),_};if(!this.is_typedef())return;this.next();const i=this.req_id();U.push(i.v[1]);let r=t()||[];const n=s();if(!(r||n))return;if(n){const _={v:["id","__children"],loc:{line:0,column:0}},p={id:"[",t:"t",v:{t:{id:"t",t:"t",v:{t:{v:["id","any"],loc:{line:0,column:0}}}}}},d=new a("field","expr",[_,p]);r.push(d)}const h=new _t(i,r,n),u=new a("type","def",h);return this.ast.push(u),!0}maybe_consts_or_fns(){let t=!1;for(;;)if(this.is_pat())this.ast.push(this.maybe_const()),t=!0;else if(this.is_fn())this.ast.push(this.maybe_fn()),t=!0;else break;return t}implicit_return(t){if(!t||t.length<=0)return;const s=t.length-1,i=t[s];if(!(l(["when","while","if","for","return","let","var","const"],i.id)||i.id==="bin"&&i.v.op.v===":=")&&i.id!==";"&&!(i.id==="bin"&&i.v.op.v==="=")&&!(i.id==="bin"&&i.v.lopr.id==="ref"&&l(["println","\u0627\u0637\u0628\u0639_\u0633\u0637\u0631"],i.v.lopr.v.v[1]))&&i.t==="expr"){const r=new a("iret","expr",i);return tt(t,s,r)}}}const wt=["min_width","min_height","background_color","background_image","background_position","background_repeat","background_size","background_attachment","_webkite_background_size","aspect_ratio","border_right","border_left","border_top","border_bottom","border_radius","border_style","margin_top","margin_bottom","margin_right","margin_left","align_items","text_align","justify_content","justify_items","text_justify","object_fit","font_size","font_family","box_sizing","scrollbar_width","user_select","_ms_user_select","_webkit_user_select","_moz_user_select","box_shadow","_webkit_box_shadow","_moz_box_shadow","no_repeat","border_box","space_between","flex_direction","inter_word"],G=["readonly"],yt=["html","body","div","span","p","textarea","field"];function k(e){return wt.includes(e)?e.replaceAll("_","-"):e}const O={\u0635\u0641\u062D\u0629_\u0627\u0644\u0634\u0628\u0643\u0629:"html",\u0631\u0627\u0633:"head",\u0646\u0633\u0642:"style",\u0645\u062A\u0646:"body",\u0645\u0646\u0637\u0642\u0629_\u0627\u0644\u0646\u0635:"textarea",\u0639\u0646\u0648\u0627\u0646_\u0631\u0627\u0633\u064A\u0663:"h3",\u0642\u0633\u0645:"div",\u0633\u0637\u0631:"br"},T=e=>{switch(e){case"\u0635\u0646\u0641":return"class";case"\u0627\u0639\u0645\u062F\u0629":return"cols";case"\u0635\u0641\u0648\u0641":return"rows";case"\u0644\u0644\u0642\u0631\u0627\u0621\u0629_\u0641\u0642\u0637":return"readonly";default:return e}},X={\u062D\u0648\u0645:"hover"},gt=e=>{switch(e){case"\u0639\u0646\u062F":return"at";case"\u0627\u0632\u0627\u062D\u0629_\u0633":return"translateX";case"\u0639\u0646\u0648\u0627\u0646":return"url";default:return e}},B=e=>{switch(e){case"\u0639_\u0635":return"px";case"\u0639_\u0637":return"vh";case"\u0645_\u062C":return"rem";case"\u062B":return"s";case"\u066A":return"%";default:return e}},S=e=>{switch(e){case"\u0639\u0646\u0635\u0631":return"element";case"\u0639\u0631\u0636":return"width";case"\u0627\u062F\u0646\u0649_\u0639\u0631\u0636":return"min_width";case"\u0627\u0631\u062A\u0641\u0627\u0639":return"height";case"\u0627\u062F\u0646\u0649_\u0627\u0631\u062A\u0641\u0627\u0639":return"min_height";case"\u0644\u0648\u0646":return"color";case"\u0627\u062A\u062C\u0627\u0647":return"direction";case"\u062E\u0644\u0641\u064A\u0629":return"background";case"\u0644\u0648\u0646_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_color";case"\u0635\u0648\u0631\u0629_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_image";case"\u0645\u0648\u0642\u0639_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_position";case"\u062A\u0643\u0631\u0627\u0631_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_repeat";case"\u0627\u0631\u0641\u0627\u0642_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_attachment";case"\u0645\u0644\u0627\u0626\u0645\u0629_\u0627\u0644\u0639\u0646\u0635\u0631":return"object_fit";case"\u062D\u062C\u0645_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"background_size";case"_\u0622\u0628\u0644_\u062D\u062C\u0645_\u0627\u0644\u062E\u0644\u0641\u064A\u0629":return"_webkite_background_size";case"\u0641\u0627\u0626\u0636":return"overflow";case"\u0639\u062A\u0627\u0645\u0629":return"opacity";case"\u0627\u0638\u0647\u0627\u0631":return"display";case"\u0647\u0627\u0645\u0634":return"margin";case"\u0647\u0627\u0645\u0634_\u0639\u0644\u0648\u064A":return"margin_top";case"\u0647\u0627\u0645\u0634_\u0633\u0641\u0644\u064A":return"margin_bottom";case"\u0647\u0627\u0645\u0634_\u0627\u064A\u0645\u0646":return"margin_right";case"\u0647\u0627\u0645\u0634_\u0627\u064A\u0633\u0631":return"margin_left";case"\u0628\u0637\u0627\u0646\u0629":return"padding";case"\u062A\u062D\u062C\u064A\u0645_\u0627\u0644\u0635\u0646\u062F\u0648\u0642":return"box_sizing";case"\u0636\u0628\u0637_\u0627\u0644\u0645\u062D\u062A\u0648\u0649":return"justify_content";case"\u0636\u0628\u0637_\u0627\u0644\u0639\u0646\u0627\u0635\u0631":return"justify_items";case"\u0636\u0628\u0637_\u0627\u0644\u0646\u0635":return"text_justify";case"\u0645\u062D\u0627\u0630\u0627\u0629_\u0627\u0644\u0639\u0646\u0627\u0635\u0631":return"align_items";case"\u0645\u062D\u0627\u0630\u0627\u0629_\u0627\u0644\u0646\u0635":return"text_align";case"\u062D\u062C\u0645_\u0627\u0644\u062E\u0637":return"font_size";case"\u0641\u0635\u064A\u0644\u0629_\u0627\u0644\u062E\u0637":return"font_family";case"\u0641\u062C\u0648\u0629":return"gap";case"\u062D\u062F\u0648\u062F":return"border";case"\u0642\u0637\u0631_\u0627\u0644\u062D\u062F\u0648\u062F":return"border_radius";case"\u0646\u0633\u0642_\u0627\u0644\u062D\u062F\u0648\u062F":return"border_style";case"\u062D\u062F\u0648\u062F_\u062E\u0627\u0631\u062C\u064A\u0629":return"outline";case"\u0645\u0648\u0636\u0639":return"position";case"\u062A\u062D\u0631\u064A\u0643":return"animation";case"\u062A\u062D\u0648\u0644":return"transform";case"\u0627\u0639\u0627\u062F\u0629_\u062A\u062D\u062C\u064A\u0645":return"resize";case"\u0645\u0635\u062F\u0631":return"src";case"\u0646\u0633\u0628\u0629_\u0633_\u0635":return"aspect_ratio";case"\u0645\u0631\u0646_\u0628\u0627\u062A\u062C\u0627\u0647":return"flex_direction";case"\u0634\u0631\u064A\u0637_\u0627\u0644\u062A\u0645\u0631\u064A\u0631_\u0639\u0631\u0636":return"scrollbar_width";case"\u0642\u062F\u0631\u0629_\u0627\u062E\u062A\u064A\u0627\u0631_\u0627\u0644\u0646\u0635":return"user_select";case"_\u0645\u0627\u064A\u0643\u0631\u0648\u0633\u0648\u0641\u062A_\u0642\u062F\u0631\u0629_\u0627\u062E\u062A\u064A\u0627\u0631_\u0627\u0644\u0646\u0635":return"_ms_user_select";case"_\u0622\u0628\u0644_\u0642\u062F\u0631\u0629_\u0627\u062E\u062A\u064A\u0627\u0631_\u0627\u0644\u0646\u0635":return"_webkit_user_select";case"_\u0645\u0648\u0632\u064A\u0644\u0627_\u0642\u062F\u0631\u0629_\u0627\u062E\u062A\u064A\u0627\u0631_\u0627\u0644\u0646\u0635":return"_moz_user_select";case"\u062E\u064A\u0627\u0644_\u0627\u0644\u0635\u0646\u062F\u0648\u0642":return"box_shadow";case"_\u0622\u0628\u0644_\u062E\u064A\u0627\u0644_\u0627\u0644\u0635\u0646\u062F\u0648\u0642":return"_webkit_box_shadow";case"_\u0645\u0648\u0632\u064A\u0644\u0627_\u062E\u064A\u0627\u0644_\u0627\u0644\u0635\u0646\u062F\u0648\u0642":return"_moz_box_shadow";default:return e}},E=e=>{switch(e){case"\u062A\u0644\u0642\u0627\u0626\u064A":return"auto";case"\u062D\u062F\u0648\u062F_\u0627\u0644\u0635\u0646\u062F\u0648\u0642":return"border_box";case"\u0628\u0644\u0627_\u0642\u064A\u0645\u0629":return"none";case"\u0645\u0637\u0644\u0642":return"absolute";case"\u0645\u0631\u0646":return"flex";case"\u0645\u062E\u0641\u064A":return"hidden";case"\u0645\u0631\u0643\u0632":return"center";case"\u0645\u0633\u0627\u0641\u0629_\u0628\u064A\u0646":return"space_between";case"\u0628\u062F\u0627\u064A\u0629":return"start";case"\u0646\u0647\u0627\u064A\u0629":return"end";case"\u0628\u0627\u0631\u0632":return"ridge";case"\u0644\u0627_\u0646\u0647\u0627\u064A\u0629":return"infinite";case"\u0644\u0627_\u062A\u0643\u0631\u0627\u0631":return"no_repeat";case"\u0627\u062D\u062A\u0648\u0627\u0621":return"contain";case"\u0642\u0637\u0639":return"clip";case"\u0636\u0639\u0641":return"double";case"\u0636\u0628\u0637":return"justify";case"\u0628\u064A\u0646_\u0627\u0644\u0643\u0644\u0645\u0627\u062A":return"inter_word";case"\u0645\u0647\u0645":return"important";case"\u063A\u064A\u0631_\u0645\u0647\u0645":return"!important";case"\u0645\u062B\u0628\u062A":return"fixed";case"\u0645\u0646_\u0627\u0644\u064A\u0645\u064A\u0646":return"rtl";case"\u0639\u0645\u0648\u062F\u064A":return"column";case"\u0627\u0641\u0642\u064A":return"row";case"\u0633\u0645\u0627\u0648\u064A_\u0641\u0627\u062A\u062D":return"lightskyblue";case"\u0627\u0628\u064A\u0636":return"white";case"\u0627\u0635\u0641\u0631":return"yellow";case"\u0627\u0633\u0648\u062F":return"black";case"\u0628\u0631\u062A\u0642\u0627\u0644\u064A":return"orange";default:return e}},qt=e=>{switch(e){case"\u0645\u062A\u0646":return"body";case"\u0635\u0641\u062D\u0629_\u0627\u0644\u0634\u0628\u0643\u0629":return"html";default:return e}};function F(e,t){switch(e.id){case"call":const s=e.v[0].v.v[1],i=O[s]||s,r=e.v[1]||[],n=e.v[2]||[];if(i==="br")return t+="<br>";switch(i){case"\u0627\u062E\u062A\u0631":t=H(r,t)+"} ";break;case"\u0639\u0631\u0641_\u062E\u0637":t=Et(r,t);break;case"\u0627\u0637\u0627\u0631\u0627\u062A_\u0631\u0626\u064A\u0633\u064A\u0629":t=jt(r,n,t);break;default:t+=`<${i}`,yt.includes(i)&&(t+=" dir='rtl'"),r.forEach((h,u)=>{if(u===0&&h.id==="str")t+=` id='${h.v.v[1]}'`;else if(h.id==="named_arg"){const _=T(h.v[0].v[1]);if(G.includes(_))t+=` ${_} `;else if(t+=` ${_}= `,h.v[1].id==="str")t+=`'${h.v[1].v.v[1]}'`;else if(h.v[1].id==="int"||h.v[1].id==="float"){const p=q(h.v[1].v[0].v[1]),d=h.v[1].v[1]&&B(h.v[1].v[1].v[1])||"";t+=`${p}${d}`}else h.v[1].id==="bool"?t+=`${T(_)}`:o("not supported: "+c(h))}else o("not supported: "+c(h))}),t+=">",n.forEach(h=>{t=F(h,t)}),t+=`</${i}>`}break;case"str":t+=e.v.v[1];break;default:o("unknown html element: "+c(e))}return t}function H(e,t){return e.forEach(s=>{const i=k(S(s.v[0].v[1])),r=s.v[1];i==="element"?(t=$t(r,t),t+=" {"):(t+=`${i} : `,t=x(r,t),t+="; ")}),t}function $t(e,t){const s=i=>{const r=n=>RegExp(`(?<![p{L}\\p{N}_])${n}(?![\\p{L}\\p{N}_])`,"ug");return Object.keys(O).forEach(n=>{i=i.replaceAll(r(n),O[n])}),Object.keys(X).forEach(n=>{i=i.replaceAll(r(n),X[n])}),i};if(y(e.v))t+=" ",e.v.forEach((i,r)=>{let n=i.v.v[1];t+=s(n),r<e.v.length-1&&(t+=",")});else{const i=e.v.v[1];t+=s(i)}return t}function x(e,t){switch(e.id){case"bool":o();break;case"int":case"float":const s=q(e.v[0].v[1]),i=B(e.v[1]&&e.v[1].v[1])||"";t+=s+i;break;case"prefix":t+=e.v.op.v,t=x(e.v.opr,t);break;case"postfix":t=x(e.v.opr,t),t+=e.v.op.v;break;case"str":t+=qt(e.v.v[1]);break;case"ref":t+=k(E(e.v.v[1]));break;case"tuple":e.v.forEach(_=>{t=x(_,t+" ")});break;case"call":const r=gt(e.v[0].v.v[1]),n=e.v[1];t+=` ${r}(`,n.forEach(_=>{t=x(_,t)}),t+=")";break;case"bin":const h=new V;h.init(),h.write_expr(e);const u=h.get_code();t+="${"+u+"}".trim();break;default:o(`not supported: html generations:  ${c(e)}`)}return t}function Et(e,t){return t+="@font-face { ",t=H(e,t),t+="}",t}function jt(e,t,s){return s+=` @keyframes ${e[0].v.v[1]} { `,t&&t.forEach(i=>{const r=i.v[0].v.v[1],n=E(i.v[1]);switch(r){case"\u0639\u0646\u062F":const h=n[0],u=n[1].v||[];s=x(h,s),s+=" {",u.forEach(_=>{if(_.id==="named_tuple")_.v.forEach(p=>{const d=k(S(p[0].v[1])),j=E(p[1]);s+=` ${d} : `,s=x(j,s),s+="; "});else{const p=k(S(_[0].v[1])),d=E(_[1]);s+=` ${p} : `,s=x(d,s),s+="; "}}),s+="} ";break;default:o("unsupported element: "+c(r))}}),s+="}",s}function K(e,t){switch(e.id){case"call":let s=e.v[0].v.v[1],i=e.v[1]||[],r=e.v[2]||[];if(s==="br")return t+="<br>";switch(s){case"select":t=zt(i,t)+"} ";break;case"font_face":t=Ct(i,t);break;case"keyframes":t=Nt(i,r,t);break;default:t+=`<${s}`,i.forEach((n,h)=>{if(h===0&&n.id==="str")t+=` id='${n.v.v[1]}'`;else if(n.id==="named_arg"){const u=n.v[0].v[1];if(G.includes(u))t+=` ${u} `;else if(t+=` ${u}= `,n.v[1].id==="str")t+=`'${n.v[1].v.v[1]}'`;else if(n.v[1].id==="int"||n.v[1].id==="float"){const _=n.v[1].v[0].v[1],p=n.v[1].v[1].v[1]||"";t+=`${_}${p}`}else n.v[1].id==="bool"?t+=`${u}`:o("not supported: "+c(n))}else o("not supported: "+c(n))}),t+=">",r.forEach(n=>{t=K(n,t)}),t+=`</${s}>`}break;case"str":t+=e.v.v[1];break;default:o("unknown html element: "+c(e))}return t}function zt(e,t){return e.forEach(s=>{const i=k(s.v[0].v[1]),r=s.v[1];i==="element"?(t=At(r,t),t+=" {"):(t+=`${i} : `,t=w(r,t),t+="; ")}),t}function At(e,t){return y(e.v)?(t+=" ",e.v.forEach((s,i)=>{t+=`${s.v.v[1]} `,i<e.v.length-1&&(t+=",")})):t+=` ${e.v.v[1]}`,t}function w(e,t){switch(e.id){case"int":case"float":const s=e.v[0].v[1],i=e.v[1]&&e.v[1].v[1]||"";t+=s+i;break;case"prefix":t+=e.v.op.v,t=w(e.v.opr,t);break;case"postfix":t=w(e.v.opr,t),t+=e.v.op.v;break;case"str":t+=e.v.v[1];break;case"ref":t+=k(e.v.v[1]);break;case"tuple":e.v.forEach(_=>{t=w(_,t+" ")});break;case"call":const r=e.v[0].v.v[1],n=e.v[1];t+=` ${r}(`,n.forEach(_=>{t=w(_,t)}),t+=")";break;case"bin":const h=new JSGen;h.init(),h.write_expr(e);const u=h.get_code();pprint(u),t+="${"+u+"}".trim();break;default:o(`not supported: html generations:  ${c(e)}`)}return t}function Ct(e,t){return t+="@font-face { ",t=write_ar_css(e,t),t+="}",t}function Nt(e,t,s){return s+=` @keyframes ${e[0].v.v[1]} { `,t&&t.forEach(i=>{const r=i.v[0].v.v[1],n=i.v[1];switch(r){case"at":const h=n[0],u=n[1].v||[];s=w(h,s),s+=" {",u.forEach(_=>{if(_.id==="named_tuple")_.v.forEach(p=>{const d=k(p[0].v[1]),j=p[1];s+=` ${d} : `,s=w(j,s),s+="; "});else{const p=k(_[0].v[1]),d=_[1];s+=` ${p} : `,s=w(d,s),s+="; "}}),s+="} ";break;default:o("unsupported element: "+c(r))}}),s+="}",s}const Ot=`
//------------------------------------------------------------------------------
// js helper functions injected to workaround missing seen features that are yet to be added.
function is_none(x) { return x == null }        
function is_list(x) { return x instanceof Array }
function replace(array, i, v) {  array[i] = v }
function to_int(str) { return parseInt(str) }
function assign(x,y) { x = y }
function concat(x,y,id) { x[id] = x[id].concat(y[id]) }
function del(array, i) { delete array[i] }
function regexp(expr) { return RegExp(expr, 'ug') }
function match_regexp(v, expr) {return expr.exec(v) }
function print(v) { throw new Error('print() is not implemeted')}
function \u0627\u0637\u0628\u0639_\u0633\u0637\u0631(v) { println(v) }
function println(v) {         
    if(v == null ) { console.log("undefined") } else { console.log(v) }
}
function panic(v) { throw new Error(v)}
function clone(obj) { return {...obj} }
function contains(list, el) { return list.includes(el) }
function is_empty(list) { return Array.isArray(list) && list.length === 0 }
function \u0627\u0637\u0628\u0639_\u062A\u0641\u0627\u0635\u064A\u0644(obj, indent) { pprint(obj, indent) }
function pprint(obj, indent) { 
    if( obj == null ) {
        console.log("undefined")
    } else {
        if(indent) {
            console.log(JSON.stringify(obj, null, indent)) 
        } else {
            console.log(JSON.stringify(obj)) 
        }       
    }
}
function to_str(obj, indent) { 
let objects = []
function eliminateCircular(k, v) {
    if (v && typeof v === 'object') {
        if (objects.includes(v)) { return "[CIRCULAR]" } else { objects.push(v) }
    }
    return v
}
if(indent) {
    return JSON.stringify(obj, eliminateCircular, indent)
} else {
    return JSON.stringify(obj, eliminateCircular)
}
}
function repeat(str, times) { return str.repeat(times) }
function c0_to_uppercase(str){ return str.charAt(0).toUpperCase() + str.slice(1) }
function to_lowercase(str) {return str.toLowerCase()}
function \u0639\u0631\u0636_\u0627\u0648\u0644\u064A(code, preview_id){ preview(code, preview_id) }
function preview(code, preview_id) { window.parent.document.querySelector(preview_id).srcdoc = code }
function \u0647\u0627\u062A_\u0627\u0644\u0627\u0641\u0631\u0639(\u0633) {
    return \u0633.__children
}
function \u0627\u062E\u062A\u0631(\u0633,\u062F\u0627\u0644\u0629) {
    return \u0633.filter(\u062F\u0627\u0644\u0629)
}
function \u0647\u0627\u062A(\u0642,\u0641\u0647\u0631\u0633) { return \u0642[\u0641\u0647\u0631\u0633]}
function \u0639\u062F\u062F_\u0627\u0644\u0639\u0646\u0627\u0635\u0631(\u0642) { return \u0642.length}
async function read_url(url) {
    const response = await fetch(url);
    return response.text()
}

//------------------------------------------------------------------------------
`,Q={\u0628\u062F\u0621:"main",\u0627\u0637\u0628\u0639_\u0633\u0637\u0631:"println",\u062A\u0639\u0628\u064A\u0631_\u0646\u0645\u0637\u064A:"regex",\u0647\u0630\u0627:"this",\u0645\u0634\u064A\u0651\u062F:"constructor",\u0627\u0646\u0647\u0627\u0621:"panic"},St=4;let V=class{current;indent_level;stack;astructs;ast;main_args;opts;constructor(e,t,s,i,r,n){return this.current=e,this.indent_level=t,this.stack=s,this.astructs=i,this.ast=r,this.opts=n,this}init(e,t,s){this.current="",this.indent_level=0,this.stack=[],this.astructs=[],this.ast=e,this.main_args=t,this.opts=s}run(){this.strict_mode();let e,t=0;for(;t<this.ast.length;){const s=this.ast[t];if(s){const i=s.v;switch(s.id){case"use":this.write_use(i);break;case"modif":this.write_modifier(i);break;case"main":e=i;break;case"const":this.write_const(i);break;case"fn":this.write_fn(i);break;case"type":this.write_typedef(i);break;default:o("unsupported node: "+this.ast[t].id)}}t+=1}return this.write_helper_fns(),e&&this.write_main(e),this.get_code()}to_en_id(e){!e.v&&!y(e.v)||Q[e.v[1]]&&(e.v[1]=Q[e.v[1]])}push(){this.stack.push(this.current),this.current=""}pop(){this.current=this.stack.pop()+this.current}pop_prepend(){this.current=this.current+this.stack.pop()}append(e){this.current+=e}appendi(e){this.current+=this.spaces(),this.current+=e}spaces(e){return e||(e=this.indent_level),et(" ",e*St)}strict_mode(){this.append(`"use strict";

`)}write_id_pat(e){const t=e.v.v[1];this.append(t==="_"?"default":t)}write_char_pat(e){this.append("'"+e.v.v[1]+"'")}write_str_pat(e){this.append('"'+e.v.v[1]+'"')}write_tuple_pat(e){this.append("(");let t=0;for(;t<e.v.length;)this.write_pat(e.v[t]),t<e.v.length-1&&this.append(", "),t+=1;this.append(")")}write_pat(e){switch(e.id){case"id":this.write_id_pat(e);break;case"bool":this.append(e.v.v[1]);break;case"int":case"float":this.append(q(e.v.v[1][0]));break;case"char":this.write_char_pat(e);break;case"str":this.write_str_pat(e);break;case"tuple":this.write_tuple_pat(e);break;case"_":this.append("default");break;default:o("unsupported pattern "+c(e))}}write_modifier(e){this.opts.ignore_export||e.v==="+"&&this.appendi("export ")}write_use(e){}write_main(e){this.push(),this.appendi("("),this.write_fn(e,this.main_args),this.appendi(`)()
`),this.pop()}write_params(e){this.append("(");let t=0;for(;t<e.length;)t>0&&this.append(", "),this.write_pat(e[t].v._pat),t+=1;this.append(")")}write_do_block(e){this.append("(()=>"),this.write_block(e),this.append(`)() 
`)}write_block(e){this.append(` {
`),this.push(),this.indent_level+=1;let t=0;const s=e.v.length;for(;t<s;){const i=e.v[t];this.write_stmt(i),t+=1}this.pop(),this.indent_level-=1,this.appendi(`}
`)}write_fn(e,t){this.push(),e.t==="fn"&&this.appendi("static "),this.to_en_id(e.name),this.append("function "+e.name.v[1]),t?this.append("()"):this.write_params(e.params),this.write_body(e.body,e.name==="main",t),this.pop()}write_fields(e){const t=[];e.forEach(s=>{const i=s.v[0].v[1];t.push(i)}),t.forEach(s=>{this.appendi(this.spaces()+""+s+`
`)}),this.write_init(t)}write_init(e){this.append(`
`),this.appendi("constructor(");let t=0;for(;t<e.length;)this.append(e[t]),t<e.length-1&&this.append(", "),t+=1;for(this.append(`) {
`),this.indent_level+=1,t=0;t<e.length;)this.appendi("this."+e[t]+" = "+e[t]+`
`),t+=1;this.appendi(`return this
`),this.indent_level-=1,this.appendi(`}
`)}write_typedef(e){this.appendi("class "+e.name.v[1]+` {
`),this.indent_level+=1,e.fields&&this.write_fields(e.fields),this.indent_level-=1,this.appendi(`}

`)}write_const(e){this.appendi("const "),this.write_pat(e.lhs),this.append(" = "),this.write_expr(e.rhs),this.append(`
`)}write_var(e){this.appendi("let "),this.write_pat(e.lhs),e.rhs&&(this.append(" = "),this.write_expr(e.rhs)),this.append(`
`)}write_ret(e){this.append("return "),e.v&&this.write_expr(e.v)}write_break(e){this.append("break")}write_stmt(e){e.t==="expr"?(this.appendi(""),this.write_expr(e),this.append(`
`)):e.id==="const"?this.write_const(e.v):e.id==="var"?this.write_var(e.v):e.id==="break"?this.write_break(e):o("cannot write stmt: "+c(e))}write_body(e,t,s){if(this.append(` {
`),this.push(),this.indent_level+=1,s)for(const[n,h]of Object.entries(s))this.append(`const ${n} = '${h}'
`);let i=0;const r=e.v.length;for(;i<r;){const n=e.v[i];this.write_stmt(n),i+=1}this.pop(),this.indent_level-=1,this.appendi(`}
`)}write_id(e){this.append(e.v[1])}write_ref(e){const t=e.v.v[1];this.append(t)}write_str(e){const t=e.v.v[1],s=t.indexOf("${")===-1?'"':"`";this.append(s+t+s)}write_str_id(e){this.append(symbol+e.v.v[1]+symbol)}is_call(e){return e.v.id==="bin"&&e.v.v.op.v==="("}write_iret(e){l(["when","while","if","for","return"],e.v.node)||e.v.t==="()"||this.is_call(e)||e.semicolon||this.append("return "),this.is_call(e)?(this.append("const temp_seen_var = "),this.write_expr(e.v),this.append(`
`),this.append("return temp_seen_var")):this.write_expr(e.v)}write_list(e){this.append("[");let t=0;const s=e.v.length;for(;t<s;)this.write_expr(e.v[t]),t<e.v.length-1&&this.append(", "),t+=1;this.append("]")}write_structl(e){const t=e.v;this.append("{");let s=0;for(;s<t.length;){const i=t[s],r=i.k;r.v.v[1]?this.write_id(r.v):this.write_str_id(r.v);const n=i.v;this.append(": "),this.write_expr(n),s<t.length-1&&this.append(", "),s+=1}this.append("}")}write_args(e){this.append("(");let t=0;for(;t<e.v.length;){let s=e.v[t];s.v.op&&s.v.op.v===":"&&(s=s.v.ropr),this.write_expr(s),t<e.v.length-1&&this.append(", "),t+=1}this.append(")")}write_named_arg(e){e.v[0].v[1];const t=e.v[1];this.write_expr(t)}write_tuple(e){this.append("[");let t=0;for(;t<e.v.length;){let s=e.v[t];s.id==="narg"&&(s=e.v[t].v[1]),this.write_expr(s),t<e.v.length-1&&this.append(", "),t+=1}this.append("]")}write_named_tuple(e){this.append("{"),e.v.forEach((t,s)=>{const i=t[0].v[1],r=t[1];this.append(i),this.append(": "),this.write_expr(r),s<e.v.length&&this.append(",")}),this.append("}")}write_when(e){this.appendi("switch("),this.write_expr(e.v.expr),this.append(`) {
`),this.indent_level+=1;let t=0;for(;t<e.v.arms.length;){const s=e.v.arms[t],i=s.v.pats,r=s.v.expr;let n=0;for(;n<i.length;)i[n].id!=="_"&&this.appendi("case "),this.write_pat(i[n]),this.append(` :
`),n+=1;this.indent_level+=1,this.appendi(""),this.write_expr(r),this.append(`
`),this.appendi(`break
`),this.indent_level-=1,t+=1}this.indent_level-=1,this.appendi(`}
`)}write_prefix_uni(e){const t=e.v.op.v;switch(t){case".":if(e.v.opr.v.v[1]==="none"){this.append("null");return}else o("enum variants are not supported, found : (."+e.v.opr.v.v[1]+")");break;case"not":this.append("!");break;case"!":case"-":this.append(t);break;default:o("unsupported op: "+t);break}this.write_expr(e.v.opr)}write_pipe(e){for(;e.length>0;){let t=e.pop();switch(t.id){case"ref":this.write_expr(t),e.length>0&&(this.append("("),this.write_pipe(e),this.append(")"));break;case"call":const s=t.v[0],i=t.v[1];this.write_expr(s),this.append("("),this.write_pipe(e),this.current.slice(-1)!=="("&&i.length>0&&this.append(", "),i.forEach((r,n)=>{this.write_expr(r),n<i.length-1&&this.append(", ")}),this.append(")");break;case"int":case"float":case"str":case"[":case"tuple":case"named_tuple":this.write_expr(t);break;default:throw new Error("syntax error |> :"+c(t))}}}write_call(e){if(this.to_en_id(e.v[0].v),e.v[0].v.v[1]==="html"){const s=K(e,"");this.append(` (() => \`${s}\`)() `);return}else if(e.v[0].v.v[1]==="\u0635\u0641\u062D\u0629_\u0627\u0644\u0634\u0628\u0643\u0629"){const s=F(e,"");this.append(`(() => \`${s}\`)()`);return}else U.includes(e.v[0].v.v[1])&&this.append("new ");this.write_expr(e.v[0]),this.append("(");const t=e.v[1];t&&t.forEach((s,i)=>{this.write_expr(s),i<t.length-1&&this.append(", ")}),e.v[2]&&(t&&this.append(", "),this.write_children(e.v[2])),this.append(")")}write_children(e){!e||e.length===0||(this.append("["),e.forEach(t=>{this.write_expr(t),this.append(",")}),this.append("]"))}write_bin(e){const t=e.v.op.v;switch(t){case"[":this.write_expr(e.v.lopr),this.append("["),this.write_expr(e.v.ropr),this.append("]");break;case"=":this.write_expr(e.v.lopr),this.append("="),this.write_expr(e.v.ropr);break;case":=":this.append("let "),this.write_expr(e.v.lopr),this.append(" = "),this.write_expr(e.v.ropr),this.append(`
`);break;case"::":this.appendi("const "),this.write_expr(e.v.lopr),this.append(" = "),this.write_expr(e.v.ropr),this.append(`
`);break;case":":this.appendi("let "),this.write_expr(e.v.lopr),this.append(`
`);break;case"|>":{let s=[],i=e.v.lopr,r=e.v.ropr;for(;;)if(s.push(i),r.id==="bin"&&r.v.op.v==="|>")i=r.v.lopr,r=r.v.ropr;else{s.push(r);break}this.write_pipe(s);break}case"||>":throw new Error(" ||> : WIP , "+c(e));case":>":throw new Error(" :> : WIP , "+c(e));case"==":case"!=":case"<":case"<=":case">":case">=":case"|":case"||":case"&":case"&&":case"+":case"-":case"/":case"*":case"+=":case"-=":case"*=":case"\\=":case".":this.write_expr(e.v.lopr),this.append(t),(t==="=="||t==="!=")&&this.append("="),this.write_expr(e.v.ropr);break;default:o("cannot write binary operation: "+c(e));break}}write_afn(e){this.push(),this.write_params(e.v.params),this.append("=>"),this.write_body(e.v.body),this.pop()}write_expr(e){switch(e.grouped&&this.append("("),e.id){case"()":break;case";":break;case"ref":this.write_ref(e);break;case"bool":this.append(e.v.v[1]);break;case"int":case"float":this.append(q(e.v[0].v[1]));break;case"char":this.append("'"+e.v.v[1]+"'");break;case"str":this.write_str(e);break;case"return":this.write_ret(e);break;case"iret":this.write_iret(e);break;case"[":this.write_list(e);break;case"{":this.write_structl(e);break;case"args":this.write_args(e);break;case"named_arg":this.write_named_arg(e);break;case"tuple":this.write_tuple(e);break;case"named_tuple":this.write_named_tuple(e);break;case"when":this.write_when(e);break;case"do_block":this.write_do_block(e);break;case"block":this.write_block(e);break;case"prefix":this.write_prefix_uni(e);break;case"call":this.write_call(e);break;case"bin":this.write_bin(e);break;case"afn":this.write_afn(e);break;default:o("cannot write expr: "+c(e))}e.grouped&&this.append(")")}write_helper_fns(){this.append(Ot)}get_code(){return this.current}};class Lt{ast;main_args;target;target_opts;init(t,s,i,r){this.ast=t,this.main_args=s,this.target=i,this.target_opts=r}run(){let t;switch(st(this.target)){case"js":t=new V;break;default:o('target "'+this.target+'" is not supported');break}return t.init(this.ast,this.main_args,this.target_opts),t.run()}}class It{src;main_args;target;target_opts;lang;tokens;ast;gen_code;constructor(t,s,i,r,n,h,u,_,p,d){return this.src=t,this.main_args=s,this.target=i,this.target_opts=r,this.lang=n,this.tokens=h,this.ast=u,this.symtab=_,this.transltab=p,this.gen_code=d,this}init(t,s,i,r){this.src=t,this.main_args=s,this.target="js",this.target_opts=r||{},this.lang=i||"en"}init_ar(t,s,i){this.init(t,s,"ar",i)}get_code(){return this.gen_code||this.compile(),this.gen_code}compile(){this.scan(!0),this.parse(),this.generate(this.target)}scan(t){const s=new ht;s.init(this.lang,this.src,t),s.run(),this.tokens=s.tokens,z(s.errs)||(I(s.errs),o(""))}parse(){const t=new xt;t.init(this.tokens),t.run(),this.ast=t.ast,z(t.errs)||(I(t.errs),o(""))}generate(t){const s=new Lt;s.init(this.ast,this.main_args,t,this.target_opts),this.gen_code=s.run()}}export{It as default};
